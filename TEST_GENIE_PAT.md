# ğŸ§ª Test Genie PAT Token Authentication

Simple standalone script to verify your PAT token works with Genie spaces.

---

## ğŸš€ Quick Start

### **Step 1: Generate PAT Token**

1. Go to Databricks UI: `https://dbc-4a93b454-f17b.cloud.databricks.com`
2. **Settings** â†’ **Developer** â†’ **Access Tokens**
3. **Generate New Token**
4. **Copy the token**

---

### **Step 2: Create `.env` file**

```bash
# Copy the example file
cp env.example .env

# Edit .env with your actual values
# (Use any text editor)
```

**`.env` contents:**
```bash
DATABRICKS_HOST=https://dbc-4a93b454-f17b.cloud.databricks.com
DATABRICKS_TOKEN=dapi1234567890abcdefghijklmnopqrstuvwxyz  # âš ï¸ PASTE YOUR TOKEN HERE
GENIE_SPACE_ID=01f0c403c3cf184e9b7f1f6c9ee45905
```

âš ï¸ **`.env` is gitignored - safe to use locally!**

---

### **Step 3: Install dependencies**

```bash
pip install databricks-sdk python-dotenv
```

---

### **Step 4: Run the test**

```powershell
python test-genie-pat.py
```

---

## âœ… Expected Output

```
ğŸ” Testing Genie API Access with PAT Token
==================================================

âœ… Host: https://dbc-4a93b454-f17b.cloud.databricks.com
âœ… Token: dapi123456...xyz (masked)
âœ… Genie Space ID: 01f0c403c3cf184e9b7f1f6c9ee45905

ğŸ”Œ Connecting to Databricks...
âœ… Databricks client initialized

ğŸ‘¤ Test 1: Verifying current user...
âœ… Authenticated as: spg1461@ftr.com
   Display Name: Greblunas, Stephen

ğŸ“¦ Test 2: Accessing Genie space...
âœ… Found Genie space: spg-mocking-bird-sales
   Description: Mock sales performance data for SPIFF agent demo
   Warehouse ID: 0962fa4cf0922125

ğŸ’¬ Test 3: Starting Genie conversation...
âœ… Genie conversation started successfully!
ğŸ“„ Response preview: Here are the top performers...

==================================================
ğŸ‰ All tests passed! PAT token authentication works!

âœ… Next step: Deploy app with this PAT token in Databricks Secrets
```

---

## âŒ Troubleshooting

### **"Failed to access Genie space"**
- Check you have "Can Run" or "Can Manage" permission
- Verify Genie space ID is correct
- Ensure you own the PAT token (generated by your account)

### **"SQL warehouse is stopped"**
- Go to **SQL Warehouses** in Databricks
- Start `hackaithon_Spiffit_serverless`

### **"Token not set in .env file"**
- Verify `.env` file exists in the project root
- Check variable names match exactly (case-sensitive)
- No extra spaces around `=`

---

## ğŸ” Security Notes

- âœ… `.env` is in `.gitignore` - won't be committed
- âœ… Never share your PAT token
- âœ… Use short-lived tokens for testing (90 days max)
- âœ… For production, use Databricks Secrets

---

## ğŸ“‹ What This Tests

1. **PAT Token Authentication** - Verifies token is valid
2. **Genie Space Access** - Confirms you have permissions
3. **Genie API Call** - Tests actual conversation creation
4. **Response Parsing** - Validates response format

---

## âœ… Next Steps After Success

If all tests pass:

1. **Store token in Databricks Secrets:**
   ```powershell
   .\setup-genie-secrets.ps1
   ```

2. **Deploy the app:**
   ```powershell
   git add streamlit/spiffit-ai-calculator/app.yaml streamlit/spiffit-ai-calculator/ai_helper.py
   git commit -m "Configure PAT token auth for Genie"
   git push origin spiffit-dev
   .\deploy-to-databricks.ps1
   ```

3. **Test in the app:**
   - Go to **ğŸ”§ Troubleshooting** tab
   - Click **"Test Genie Query"**
   - Should now work! âœ…

---

## ğŸ†˜ Need Help?

If tests fail:
1. Check the error message
2. Follow troubleshooting steps above
3. Verify SQL warehouse is running
4. Confirm Genie space permissions

